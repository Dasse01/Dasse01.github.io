<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ì•½ìˆ í˜• ë…¼ìˆ  í•©ë¶ˆíŒë‹¨ê¸°</title>
  
  <!-- Pretendard í°íŠ¸ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
  
  <style>
    :root{
      --bg:#080d19;
      --bg-card:rgba(15,23,42,0.85);
      --bg-card-hover:rgba(20,30,55,0.95);
      --txt:#f1f5f9;
      --txt-muted:#94a3b8;
      --txt-dim:#64748b;
      
      --line:rgba(148,163,184,0.12);
      --line-hover:rgba(148,163,184,0.25);
      
      --accent:#f59e0b;
      --accent-glow:rgba(245,158,11,0.35);
      
      --good:#10b981;
      --good-bg:rgba(220,38,38,0.08);
      --mid:#f59e0b;
      --mid-bg:rgba(245,158,11,0.12);
      --bad:#ef4444;
      --bad-bg:rgba(239,68,68,0.12);
      --info:#3b82f6;
      --info-bg:rgba(59,130,246,0.12);
      
      --shadow-sm:0 2px 8px rgba(0,0,0,0.25);
      --shadow-md:0 8px 24px rgba(0,0,0,0.35);
      
      --radius-sm:10px;
      --radius-md:16px;
      --radius-lg:24px;
      --radius-full:9999px;
      
      --transition-fast:0.15s cubic-bezier(0.4,0,0.2,1);
      --transition-normal:0.25s cubic-bezier(0.4,0,0.2,1);
    }
    
    *{box-sizing:border-box; margin:0; padding:0}
    html{scroll-behavior:smooth}
    
    body{
      color:var(--txt);
      background: 
        radial-gradient(ellipse 80% 50% at 20% -20%, rgba(220,38,38,0.08), transparent),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(245,158,11,0.06), transparent),
        linear-gradient(180deg, var(--bg) 0%, #0f172a 100%);
      background-attachment: fixed;
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      font-size:14px;
      line-height:1.6;
      min-height:100vh;
    }
    
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-track{background:rgba(0,0,0,0.2);border-radius:4px}
    ::-webkit-scrollbar-thumb{background:rgba(148,163,184,0.3);border-radius:4px}
    ::-webkit-scrollbar-thumb:hover{background:rgba(148,163,184,0.5)}
    
    header{max-width:1200px;margin:0 auto;padding:32px 24px 16px}
    
    h1{
      font-size:clamp(22px, 4vw, 28px);
      font-weight:700;
      letter-spacing:-0.5px;
      background:linear-gradient(135deg, #f59e0b 0%, #fcd34d 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      margin-bottom:8px;
    }
    
    .sub{color:var(--txt-muted);font-size:14px;line-height:1.5}
    .sub b{color:var(--accent);font-weight:600}
    
    .wrap{max-width:1200px;margin:0 auto;padding:0 24px 48px}
    .grid{display:grid;grid-template-columns:1fr;gap:20px;align-items:start}
    @media(min-width:900px){.grid{grid-template-columns:380px 1fr}}
    
    .panel{
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      border:1px solid var(--line);
      border-radius:var(--radius-lg);
      overflow:hidden;
      transition: all var(--transition-normal);
    }
    .panel:hover{border-color:var(--line-hover)}
    .panel .hd{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:16px 20px;
      border-bottom:1px solid var(--line);
      background:rgba(0,0,0,0.15);
    }
    .panel .hd b{font-size:15px;font-weight:600}
    .panel .bd{padding:20px}
    
    .card{
      background:rgba(0,0,0,0.2);
      border:1px solid var(--line);
      border-radius:var(--radius-md);
      padding:16px;
    }
    
    .label{
      font-size:12px;
      font-weight:600;
      color:var(--txt-muted);
      text-transform:uppercase;
      letter-spacing:0.5px;
      margin-bottom:6px;
    }
    
    .hint{
      font-size:12px;
      color:var(--txt-dim);
      margin-top:4px;
    }
    
    input, select{
      width:100%;
      padding:10px 14px;
      border:1px solid var(--line);
      border-radius:var(--radius-sm);
      background:rgba(0,0,0,0.3);
      color:var(--txt);
      font-size:14px;
      font-family:inherit;
      transition:all var(--transition-fast);
    }
    input:focus, select:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 3px var(--accent-glow);
    }
    
    button{
      padding:10px 18px;
      border:1px solid var(--line);
      border-radius:var(--radius-sm);
      background:rgba(255,255,255,0.05);
      color:var(--txt);
      font-size:13px;
      font-weight:500;
      font-family:inherit;
      cursor:pointer;
      transition:all var(--transition-fast);
    }
    button:hover{background:rgba(255,255,255,0.1);border-color:var(--line-hover)}
    button.primary{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }
    button.primary:hover{background:#059669;border-color:#059669}
    
    .badge{
      display:inline-flex;
      align-items:center;
      padding:4px 10px;
      border-radius:var(--radius-full);
      background:var(--accent-glow);
      color:var(--txt);
      font-size:11px;
      font-weight:600;
    }
    
    .row{display:flex;flex-wrap:wrap;align-items:center;gap:8px}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:600px){.two{grid-template-columns:1fr}}
    
    .gap-sm{gap:8px}
    .mt-sm{margin-top:8px}
    .mt-md{margin-top:16px}
    .mt-lg{margin-top:24px}
    
    .kpi{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(90px, 1fr));
      gap:12px;
      margin-top:16px;
    }
    .kpi .box{
      background:rgba(0,0,0,0.25);
      border:1px solid var(--line);
      border-radius:var(--radius-md);
      padding:14px;
      text-align:center;
    }
    .kpi .big{font-size:18px;font-weight:700;color:var(--txt)}
    .kpi .small{font-size:10px;color:var(--txt-muted);margin-top:4px}
    
    .scroll{overflow-x:auto;-webkit-overflow-scrolling:touch}
    .scroll-hint{font-size:11px;color:var(--txt-dim);text-align:right}
    
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      white-space:nowrap;
    }
    th,td{
      padding:10px 12px;
      text-align:left;
      border-bottom:1px solid var(--line);
    }
    th{
      font-weight:600;
      color:var(--txt-muted);
      background:rgba(0,0,0,0.2);
      position:sticky;
      top:0;
      z-index:1;
    }
    td.num,th.num{text-align:right;font-variant-numeric:tabular-nums}
    tr:hover{background:rgba(255,255,255,0.02)}
    
    .status{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:var(--radius-full);
      font-size:12px;
      font-weight:600;
    }
    .status.ì•ˆì •,.status.ê°€ëŠ¥{background:var(--good-bg);color:var(--good)}
    .status.ì ì •,.status.ê²½ìŸ{background:var(--mid-bg);color:var(--mid)}
    .status.ë„ì „{background:var(--info-bg);color:var(--info)}
    .status.ìœ„í—˜{background:var(--bad-bg);color:var(--bad)}
    
    .pdot{width:8px;height:8px;border-radius:50%}
    
    .chartWrap{
      background:rgba(0,0,0,0.15);
      border-radius:var(--radius-md);
      padding:16px;
    }
    .chartTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }
    .chartTitle b{font-size:13px}
    .chartLegend{display:flex;gap:16px;font-size:11px;color:var(--txt-muted)}
    .lgItem{display:flex;align-items:center;gap:6px}
    .lgSw{width:12px;height:12px;border-radius:3px}
    
    .svgChart{display:block;width:100%;height:auto}
    
    .modal-overlay{
      display:none;
      position:fixed;
      top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.75);
      z-index:1000;
      overflow-y:auto;
      padding:24px;
    }
    .modal-overlay.show{display:flex;justify-content:center;align-items:flex-start}
    .modal-content{
      width:100%;
      max-width:900px;
      margin:auto;
    }
    
    .footer{
      text-align:center;
      padding:32px;
      color:var(--txt-dim);
      font-size:12px;
    }

    .info-box{
      background:var(--info-bg);
      border:1px solid rgba(59,130,246,0.3);
      border-radius:var(--radius-md);
      padding:14px;
      margin-bottom:16px;
    }
    .info-box .title{font-weight:600;color:var(--info);margin-bottom:6px}
    .info-box ul{margin:0;padding-left:18px;color:var(--txt-muted);font-size:13px}
    .info-box li{margin:4px 0}
  </style>
</head>
<body>

<header>
  <h1>ğŸ“ ì•½ìˆ í˜• ë…¼ìˆ  í•©ë¶ˆíŒë‹¨ê¸°</h1>
  <p class="sub">
    <b>v1.0</b> 2027í•™ë…„ë„ ì•½ìˆ í˜• ë…¼ìˆ  ì „ìš© Â· ë‚´ì‹  í™˜ì‚° + ì˜ˆìƒì ìˆ˜ ê³„ì‚° Â· ëŒ€í•™ë³„ ë¹„êµ ë¶„ì„
  </p>
</header>

<div class="wrap">

  <div class="info-box">
    <div class="title">ğŸ’¡ ì•½ìˆ í˜• ë…¼ìˆ ì´ë€?</div>
    <ul>
      <li>êµ­ì–´ + ìˆ˜í•™ í˜¼í•© ì¶œì œ (ë‹¨ë‹µí˜•/ì§§ì€ ì„œìˆ í˜•)</li>
      <li>ê³ ì‚¬ ì‹œê°„: 60~80ë¶„ (ìˆ˜ë¦¬ë…¼ìˆ  ëŒ€ë¹„ ì§§ìŒ)</li>
      <li>ë‚œì´ë„: ìˆ˜ëŠ¥ ì—°ê³„ ìˆ˜ì¤€ (ìˆ˜ë¦¬ë…¼ìˆ  ëŒ€ë¹„ ë‚®ìŒ)</li>
      <li>ëŒ€ìƒ: ì¤‘ìœ„ê¶Œ ëŒ€í•™ (ê°€ì²œëŒ€, ìˆ˜ì›ëŒ€, ì„ì§€ëŒ€ ë“±)</li>
      <li>ë…¼ìˆ  100% ëŒ€í•™ ë‹¤ìˆ˜ â†’ ë‚´ì‹  ì•½ì  ë³´ì™„ ê°€ëŠ¥</li>
    </ul>
  </div>

  <div class="grid">

    <!-- ì…ë ¥ íŒ¨ë„ -->
    <section class="panel" id="inputPanel">
      <div class="hd">
        <b>ğŸ“Š ì…ë ¥</b>
        <span class="badge">ì•½ìˆ í˜• ì „ìš©</span>
      </div>
      <div class="bd">

        <div class="card">
          <div class="two">
            <div>
              <div class="label">ë‚´ì‹  ë“±ê¸‰ (1.0~9.0)</div>
              <input id="inGpa" type="number" min="1" max="9" step="0.1" value="5.5">
              <div class="hint">êµ­ìˆ˜ì˜íƒ í‰ê·  ë“±ê¸‰</div>
            </div>
            <div>
              <div class="label">ì•½ìˆ í˜• ë…¼ìˆ  ì ìˆ˜ (0~100)</div>
              <input id="inEssay" type="number" min="0" max="100" step="0.1" value="75">
              <div class="hint">ëª¨ì˜ ë˜ëŠ” ì˜ˆìƒ ì ìˆ˜</div>
            </div>
          </div>
        </div>

        <div class="card mt-md">
          <div class="two">
            <div>
              <div class="label">í•„í„°</div>
              <select id="inFilter">
                <option value="">ì „ì²´</option>
                <option value="essay100">ë…¼ìˆ  100%</option>
                <option value="gpa20">ë‚´ì‹  20% ì´í•˜</option>
                <option value="seoul">ìˆ˜ë„ê¶Œ</option>
              </select>
            </div>
            <div>
              <div class="label">ëŒ€í•™ ì„ íƒ</div>
              <select id="inUni"></select>
            </div>
          </div>
        </div>

        <div class="row mt-md" style="justify-content:flex-end">
          <button id="btnCalc" class="primary" type="button">ê³„ì‚°</button>
          <button id="btnRanking" type="button">ì „ì²´ ë­í‚¹</button>
          <button id="btnEdit" type="button">DB í¸ì§‘</button>
        </div>

      </div>
    </section>

    <!-- ê²°ê³¼ íŒ¨ë„ -->
    <section class="panel" id="resultPanel">
      <div class="hd">
        <b>ğŸ“‹ ë¶„ì„ ê²°ê³¼</b>
        <span class="badge" id="badgeUni">-</span>
      </div>
      <div class="bd">

        <div class="kpi">
          <div class="box"><div class="big" id="kpiTotal">-</div><div class="small">ì˜ˆìƒ í•©ì‚°ì ìˆ˜</div></div>
          <div class="box"><div class="big" id="kpiVerdict">-</div><div class="small">íŒì •</div></div>
          <div class="box"><div class="big" id="kpiWeights">-</div><div class="small">ê°€ì¤‘ì¹˜</div></div>
          <div class="box"><div class="big" id="kpiCut">-</div><div class="small">ì»·ì˜¤í”„</div></div>
          <div class="box"><div class="big" id="kpiMargin">-</div><div class="small">ë§ˆì§„</div></div>
        </div>

        <div class="card mt-lg" id="topCard">
          <div class="label">TOP ì¶”ì²œ (ì˜ˆìƒì ìˆ˜ - ì»·ì˜¤í”„ ë§ˆì§„ ìˆœ)</div>
          <div class="scroll-hint">ğŸ‘‰ ì¢Œìš°ë¡œ ìŠ¤í¬ë¡¤í•˜ì„¸ìš”</div>
          <div class="scroll mt-sm">
            <table id="tblTop">
              <thead>
                <tr><th>#</th><th>ëŒ€í•™</th><th class="num">ì˜ˆìƒì ìˆ˜</th><th class="num">ì»·ì˜¤í”„</th><th class="num">ë§ˆì§„</th><th>íŒì •</th><th>ë©”ëª¨</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card mt-lg">
          <div class="label">ì „ì²´ ëŒ€í•™ ë¹„êµ</div>
          <div class="scroll-hint">ğŸ‘‰ ì¢Œìš°ë¡œ ìŠ¤í¬ë¡¤í•˜ì„¸ìš”</div>
          <div class="scroll mt-sm">
            <table id="tblAll">
              <thead>
                <tr><th>ëŒ€í•™</th><th class="num">ë…¼ìˆ %</th><th class="num">ë‚´ì‹ %</th><th class="num">ë‚´ì‹ (í™˜ì‚°)</th><th class="num">ì˜ˆìƒì ìˆ˜</th><th class="num">ì»·ì˜¤í”„</th><th class="num">ë§ˆì§„</th><th>íŒì •</th><th>íƒœê·¸</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card mt-lg">
          <div class="label">ë¹„êµ ì°¨íŠ¸</div>
          <div class="chartWrap mt-sm">
            <div class="chartTitle">
              <b>ì˜ˆìƒì ìˆ˜ vs ì»·ì˜¤í”„</b>
              <div class="chartLegend">
                <span class="lgItem"><span class="lgSw" style="background:var(--good)"></span>ì˜ˆìƒì ìˆ˜</span>
                <span class="lgItem"><span class="lgSw" style="background:var(--mid)"></span>ì»·ì˜¤í”„</span>
              </div>
            </div>
            <div id="svgChart"></div>
          </div>
        </div>

      </div>
    </section>

  </div>

  <!-- 2027 ì•½ìˆ í˜• ëŒ€í•™ í˜„í™© -->
  <section class="panel mt-lg" id="dataCard">
    <div class="hd">
      <b>ğŸ” 2027 ì•½ìˆ í˜• ë…¼ìˆ  ëŒ€í•™ í˜„í™©</b>
      <span class="badge" id="dataBadge">15ê°œ ëŒ€í•™</span>
    </div>
    <div class="bd">
      <div class="scroll-hint">ğŸ‘‰ ì¢Œìš°ë¡œ ìŠ¤í¬ë¡¤í•˜ì„¸ìš”</div>
      <div class="scroll mt-sm">
        <table id="tblData">
          <thead>
            <tr><th>ëŒ€í•™</th><th>ê³ ì‚¬ ì‹œê°„</th><th>ëª¨ì§‘ë‹¨ìœ„</th><th>ì¶œì œ ìœ í˜•</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

</div>

<!-- DB í¸ì§‘ ëª¨ë‹¬ -->
<div id="editModal" class="modal-overlay">
  <div class="modal-content">
    <div class="panel">
      <div class="hd">
        <b>ğŸ“‹ ì•½ìˆ í˜• ë…¼ìˆ  DB í¸ì§‘</b>
        <div class="row gap-sm">
          <button id="btnSave" class="primary" type="button">ì €ì¥</button>
          <button id="btnClose" type="button">ë‹«ê¸°</button>
        </div>
      </div>
      <div class="bd">
        <div class="hint">â€¢ ì„¤ì •ì€ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤ (LocalStorage)</div>
        <div class="scroll mt-md">
          <table id="tblEdit">
            <thead><tr><th>ëŒ€í•™</th><th class="num">ë…¼ìˆ %</th><th class="num">ë‚´ì‹ %</th><th class="num">ì»·ì˜¤í”„</th><th>ë‚´ì‹ í™˜ì‚°</th><th>íƒœê·¸</th><th>ë©”ëª¨</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="row gap-sm mt-md">
          <button id="btnAddUni" type="button">ëŒ€í•™ ì¶”ê°€</button>
          <button id="btnReset" type="button">ê¸°ë³¸ê°’ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="footer">
  ì•½ìˆ í˜• ë…¼ìˆ  í•©ë¶ˆíŒë‹¨ê¸° | 2027í•™ë…„ë„ ì•½ìˆ í˜• ë…¼ìˆ  ì „ìš©
</footer>

<script>
// ============================================
// ì•½ìˆ í˜• ë…¼ìˆ  ëŒ€í•™ DB
// ============================================
const DEFAULT_DB = [
  { u: "ê°€ì²œëŒ€", essayW: 100, gpaW: 0, cut: 78, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%", "ìˆ˜ë„ê¶Œ"], memo: "êµ­ì–´6+ìˆ˜í•™9ë¬¸í•­" },
  { u: "ê°•ë‚¨ëŒ€", essayW: 100, gpaW: 0, cut: 72, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%", "ìˆ˜ë„ê¶Œ"], memo: "êµ­ì–´3+ìˆ˜í•™7ë¬¸í•­, 60ë¶„" },
  { u: "êµ­ë¯¼ëŒ€", essayW: 100, gpaW: 0, cut: 76, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%", "ìˆ˜ë„ê¶Œ"], memo: "êµ­ì–´2+ìˆ˜í•™9ë¬¸í•­, 90ë¶„" },
  { u: "ì‚¼ìœ¡ëŒ€", essayW: 100, gpaW: 0, cut: 70, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%", "ìˆ˜ë„ê¶Œ"], memo: "êµ­ì–´6+ìˆ˜í•™9ë¬¸í•­, 80ë¶„" },
  { u: "ìƒëª…ëŒ€", essayW: 100, gpaW: 0, cut: 74, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%", "ìˆ˜ë„ê¶Œ"], memo: "êµ­ì–´2+ìˆ˜í•™8ë¬¸í•­, 60ë¶„" },
  { u: "ì„œê²½ëŒ€", essayW: 100, gpaW: 0, cut: 68, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%", "ìˆ˜ë„ê¶Œ"], memo: "êµ­ì–´4+ìˆ˜í•™4ë¬¸í•­, 60ë¶„" },
  { u: "ìˆ˜ì›ëŒ€", essayW: 100, gpaW: 0, cut: 65, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%"], memo: "êµ­ì–´5+ìˆ˜í•™10ë¬¸í•­, 80ë¶„" },
  { u: "ì‹ í•œëŒ€(ì˜ì •ë¶€)", essayW: 100, gpaW: 0, cut: 62, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%", "ìˆ˜ë„ê¶Œ"], memo: "êµ­ì–´6+ìˆ˜í•™9ë¬¸í•­, 80ë¶„" },
  { u: "ì„ì§€ëŒ€(ì„±ë‚¨)", essayW: 100, gpaW: 0, cut: 68, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%", "ìˆ˜ë„ê¶Œ"], memo: "êµ­ì–´7+ìˆ˜í•™7ë¬¸í•­, 70ë¶„" },
  { u: "í•œêµ­ê³µí•™ëŒ€", essayW: 100, gpaW: 0, cut: 72, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%"], memo: "ìˆ˜í•™9ë¬¸í•­, 90ë¶„" },
  { u: "í•œêµ­ê¸°ìˆ êµìœ¡ëŒ€", essayW: 100, gpaW: 0, cut: 70, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%"], memo: "ìˆ˜í•™10ë¬¸í•­, 80ë¶„" },
  { u: "í•œì‹ ëŒ€", essayW: 100, gpaW: 0, cut: 64, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%"], memo: "êµ­ì–´5+ìˆ˜í•™10ë¬¸í•­, 80ë¶„" },
  { u: "í™ìµëŒ€(ì„¸ì¢…)", essayW: 100, gpaW: 0, cut: 74, gpaTable: "ë“±ê¸‰ë³„", tags: ["ë…¼ìˆ 100%"], memo: "ìˆ˜í•™7ë¬¸í•­, 70ë¶„" }
];

// 2027 ì•½ìˆ í˜• ëŒ€í•™ í˜„í™© ë°ì´í„°
const DATA_2027 = [
  { ëŒ€í•™: "ê°€ì²œëŒ€ (ì„±ë‚¨)", ê³ ì‚¬ì‹œê°„: "80ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´ 6ë¬¸í•­ + ìˆ˜í•™ 9ë¬¸í•­, 150ì (ê° 10ì ) + 650ì (ê¸°ë³¸ì ìˆ˜) = 800ì " },
  { ëŒ€í•™: "ê°•ë‚¨ëŒ€ (ìš©ì¸)", ê³ ì‚¬ì‹œê°„: "60ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´(ë¬¸í•™, ë…ì„œ) 3ë¬¸í•­ + ìˆ˜í•™(ìˆ˜í•™â… , ìˆ˜í•™â…¡) 7ë¬¸í•­" },
  { ëŒ€í•™: "êµ­ë¯¼ëŒ€", ê³ ì‚¬ì‹œê°„: "90ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´(êµ­ì–´, ë¬¸í•™, ë…ì„œ) 2ë¬¸í•­ + ìˆ˜í•™(ìˆ˜í•™, ìˆ˜í•™â… , ìˆ˜í•™â…¡, ë¯¸ì ë¶„) 9ë¬¸í•­" },
  { ëŒ€í•™: "ì‚¼ìœ¡ëŒ€", ê³ ì‚¬ì‹œê°„: "80ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´ 6ë¬¸í•­ + ìˆ˜í•™ 9ë¬¸í•­, 150ì (ê° 10ì ) + 550ì (ê¸°ë³¸ì ìˆ˜) = 700ì " },
  { ëŒ€í•™: "ìƒëª…ëŒ€", ê³ ì‚¬ì‹œê°„: "60ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´ 2ë¬¸í•­ + ìˆ˜í•™ 8ë¬¸í•­, 100ì (ê° 10ì ), í™˜ì‚°ì ìˆ˜ 900ì  ë§Œì " },
  { ëŒ€í•™: "ì„œê²½ëŒ€", ê³ ì‚¬ì‹œê°„: "60ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ë¯¸ë˜ìœµí•©í•™ë¶€", ì¶œì œìœ í˜•: "êµ­ì–´ 4ë¬¸í•­ + ìˆ˜í•™ 4ë¬¸í•­, ë¬¸í•­ë‹¹ 10ì , ì´ì  80ì (í™˜ì‚°ì ìˆ˜ 800ì )" },
  { ëŒ€í•™: "ìˆ˜ì›ëŒ€ (í™”ì„±)", ê³ ì‚¬ì‹œê°„: "80ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´ 5ë¬¸í•­ + ìˆ˜í•™ 10ë¬¸í•­, 150ì (ê° 10ì ) + 450ì (ê¸°ë³¸ì ìˆ˜) = 600ì " },
  { ëŒ€í•™: "ì‹ í•œëŒ€ (ì˜ì •ë¶€)", ê³ ì‚¬ì‹œê°„: "80ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´ 6ë¬¸í•­ + ìˆ˜í•™ 9ë¬¸í•­ = 15ë¬¸í•­, 750ì  ê¸°ë³¸ì ìˆ˜ = 900ì " },
  { ëŒ€í•™: "ì„ì§€ëŒ€ (ì„±ë‚¨)", ê³ ì‚¬ì‹œê°„: "70ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´ 7ë¬¸í•­ + ìˆ˜í•™ 7ë¬¸í•­ = 14ë¬¸í•­, í•µì‹¬ì–´ë¡œ ì´ë£¨ì–´ì§„ ë¬¸ì¥ì´ë‚˜ ìˆ˜ì‹ìœ¼ë¡œ ê°„ëµí•˜ê²Œ ë‹µë³€" },
  { ëŒ€í•™: "í•œêµ­ê³µí•™ëŒ€ (ì‹œí¥)", ê³ ì‚¬ì‹œê°„: "90ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "ìˆ˜í•™ 9ë¬¸í•­, 150ì  + 250ì (ê¸°ë³¸ì ìˆ˜)=400ì " },
  { ëŒ€í•™: "í•œêµ­ê¸°ìˆ êµìœ¡ëŒ€ (ì²œì•ˆ)", ê³ ì‚¬ì‹œê°„: "80ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "ìˆ˜ë¦¬ë…¼ìˆ  ë¬¸í•­ 10ê°œ ë‚´ì™¸(ë‹¨ë¬¸í˜• ì§€ë¬¸, ë‹¨ë‹µí˜•/ì•½ìˆ í˜• ì„œìˆ )" },
  { ëŒ€í•™: "í•œì‹ ëŒ€ (ì˜¤ì‚°)", ê³ ì‚¬ì‹œê°„: "80ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµ­ì–´ 5ë¬¸í•­ + ìˆ˜í•™ 10ë¬¸í•­, 120ì (ê° 8ì ) + 480ì (ê¸°ë³¸ì ìˆ˜) = 600ì " },
  { ëŒ€í•™: "í™ìµëŒ€ (ì„¸ì¢…)", ê³ ì‚¬ì‹œê°„: "70ë¶„", ëª¨ì§‘ë‹¨ìœ„: "ìì—°", ì¶œì œìœ í˜•: "êµê³¼ì„œ, EBS ìˆ˜ëŠ¥êµì¬ ë“±ì„ ë³€í˜•í•œ ìˆ˜í•™ ì„œìˆ í˜• 7ë¬¸í•­" }
];

const STORAGE_KEY = "shortEssayDB_v1";

// ============================================
// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
// ============================================
const $ = id => document.getElementById(id);
const safeNum = (v, d) => { const n = parseFloat(v); return isFinite(n) ? n : d; };

// ============================================
// DB ê´€ë¦¬
// ============================================
let DB = [];

function loadDB() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      DB = JSON.parse(saved);
    } else {
      DB = JSON.parse(JSON.stringify(DEFAULT_DB));
    }
  } catch (e) {
    DB = JSON.parse(JSON.stringify(DEFAULT_DB));
  }
}

function saveDB() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(DB));
}

function resetDB() {
  if (confirm("ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    DB = JSON.parse(JSON.stringify(DEFAULT_DB));
    saveDB();
    buildUniOptions();
    renderEditTable();
    calculate();
  }
}

// ============================================
// ë‚´ì‹  í™˜ì‚° í•¨ìˆ˜
// ============================================
function convertGpa(gpa, gpaW) {
  if (gpaW === 0) return 100;
  
  const table = { 1: 100, 2: 98, 3: 95, 4: 90, 5: 85, 6: 75, 7: 60, 8: 40, 9: 0 };
  
  const floor = Math.floor(gpa);
  const ceil = Math.ceil(gpa);
  
  if (floor === ceil || ceil > 9) return table[floor] || 0;
  
  const ratio = gpa - floor;
  const low = table[floor] || 0;
  const high = table[ceil] || 0;
  
  return low + (high - low) * ratio;
}

// ============================================
// ì ìˆ˜ ê³„ì‚°
// ============================================
function calcScore(uni, gpa, essay) {
  const gpa100 = convertGpa(gpa, uni.gpaW);
  const essayScore = essay * (uni.essayW / 100);
  const gpaScore = gpa100 * (uni.gpaW / 100);
  const total = essayScore + gpaScore;
  
  return { gpa100: +gpa100.toFixed(1), total: +total.toFixed(1), cut: uni.cut || 0 };
}

function getVerdict(total, cut) {
  if (!cut || cut === 0) return { name: "-", color: "var(--txt-dim)" };
  const margin = total - cut;
  if (margin >= 5) return { name: "ì•ˆì •", color: "var(--good)" };
  if (margin >= 0) return { name: "ì ì •", color: "var(--mid)" };
  if (margin >= -5) return { name: "ë„ì „", color: "var(--info)" };
  return { name: "ìœ„í—˜", color: "var(--bad)" };
}

// ============================================
// UI ë¹Œë“œ
// ============================================
function buildUniOptions() {
  const sel = $("inUni");
  const filter = $("inFilter").value;
  
  sel.innerHTML = "";
  
  let items = DB.slice();
  if (filter === "essay100") items = items.filter(x => x.essayW === 100);
  if (filter === "gpa20") items = items.filter(x => x.gpaW <= 20);
  if (filter === "seoul") items = items.filter(x => (x.tags || []).includes("ìˆ˜ë„ê¶Œ"));
  
  items.sort((a, b) => a.u.localeCompare(b.u, 'ko'));
  
  for (const it of items) {
    const o = document.createElement("option");
    o.value = it.u;
    o.textContent = it.u;
    sel.appendChild(o);
  }
}

function renderDataTable() {
  const tbody = document.querySelector("#tblData tbody");
  tbody.innerHTML = "";
  
  for (const r of DATA_2027) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><b>${r.ëŒ€í•™}</b></td>
      <td>${r.ê³ ì‚¬ì‹œê°„}</td>
      <td>${r.ëª¨ì§‘ë‹¨ìœ„}</td>
      <td style="white-space:normal;max-width:400px;line-height:1.5">${r.ì¶œì œìœ í˜•}</td>
    `;
    tbody.appendChild(tr);
  }
  
  $("dataBadge").textContent = `${DATA_2027.length}ê°œ ëŒ€í•™`;
}

// ============================================
// ê³„ì‚° ë° ë Œë”ë§
// ============================================
function calculate() {
  const gpa = safeNum($("inGpa").value, 5.5);
  const essay = safeNum($("inEssay").value, 75);
  const selectedUni = $("inUni").value;
  
  const uni = DB.find(x => x.u === selectedUni);
  
  if (uni) {
    const { gpa100, total, cut } = calcScore(uni, gpa, essay);
    const v = getVerdict(total, cut);
    const margin = cut ? (total - cut).toFixed(1) : "-";
    
    $("kpiTotal").textContent = total;
    $("kpiVerdict").textContent = v.name;
    $("kpiVerdict").style.color = v.color;
    $("kpiWeights").textContent = `${uni.essayW}/${uni.gpaW}`;
    $("kpiCut").textContent = cut || "-";
    $("kpiMargin").textContent = margin;
    $("kpiMargin").style.color = parseFloat(margin) >= 0 ? "var(--good)" : "var(--bad)";
    $("badgeUni").textContent = uni.u;
  }
  
  renderAllTable(gpa, essay);
  renderTopTable(gpa, essay);
  renderChart(gpa, essay);
}

function renderAllTable(gpa, essay) {
  const tbody = document.querySelector("#tblAll tbody");
  tbody.innerHTML = "";
  
  const results = DB.map(uni => {
    const { gpa100, total, cut } = calcScore(uni, gpa, essay);
    const margin = cut ? total - cut : 0;
    return { uni, gpa100, total, cut, margin, v: getVerdict(total, cut) };
  }).sort((a, b) => b.margin - a.margin);
  
  for (const r of results) {
    const tr = document.createElement("tr");
    const marginClass = r.margin >= 0 ? "style='color:var(--good)'" : "style='color:var(--bad)'";
    const marginSign = r.margin >= 0 ? "+" : "";
    
    tr.innerHTML = `
      <td><b>${r.uni.u}</b></td>
      <td class="num">${r.uni.essayW}</td>
      <td class="num">${r.uni.gpaW}</td>
      <td class="num">${r.gpa100}</td>
      <td class="num"><b>${r.total}</b></td>
      <td class="num">${r.cut || "-"}</td>
      <td class="num" ${marginClass}>${r.cut ? marginSign + r.margin.toFixed(1) : "-"}</td>
      <td><span class="status ${r.v.name}"><span class="pdot" style="background:${r.v.color}"></span>${r.v.name}</span></td>
      <td>${(r.uni.tags || []).map(t => `<span class="badge" style="font-size:10px;padding:2px 6px;margin:1px">${t}</span>`).join('')}</td>
    `;
    tbody.appendChild(tr);
  }
}

function renderTopTable(gpa, essay) {
  const tbody = document.querySelector("#tblTop tbody");
  tbody.innerHTML = "";
  
  const results = DB.map(uni => {
    const { total, cut } = calcScore(uni, gpa, essay);
    const margin = cut ? total - cut : -999;
    return { uni, total, cut, margin, v: getVerdict(total, cut) };
  })
  .filter(r => r.margin > -999)
  .sort((a, b) => b.margin - a.margin)
  .slice(0, 10);
  
  let rank = 0;
  for (const r of results) {
    rank++;
    const tr = document.createElement("tr");
    const marginClass = r.margin >= 0 ? "style='color:var(--good)'" : "style='color:var(--bad)'";
    const marginSign = r.margin >= 0 ? "+" : "";
    
    tr.innerHTML = `
      <td>${rank}</td>
      <td><b>${r.uni.u}</b></td>
      <td class="num"><b>${r.total}</b></td>
      <td class="num">${r.cut}</td>
      <td class="num" ${marginClass}>${marginSign}${r.margin.toFixed(1)}</td>
      <td><span class="status ${r.v.name}"><span class="pdot" style="background:${r.v.color}"></span>${r.v.name}</span></td>
      <td>${r.uni.memo || ""}</td>
    `;
    tbody.appendChild(tr);
  }
}

function renderChart(gpa, essay) {
  const container = $("svgChart");
  
  const results = DB.map(uni => {
    const { total, cut } = calcScore(uni, gpa, essay);
    return { name: uni.u, total, cut };
  })
  .filter(r => r.cut > 0)
  .sort((a, b) => b.total - a.total)
  .slice(0, 12);
  
  const rowH = 32;
  const leftW = 120;
  const barW = 350;
  const h = results.length * rowH + 30;
  const w = leftW + barW + 80;
  
  const maxVal = Math.max(...results.map(r => Math.max(r.total, r.cut)), 100);
  
  let svg = `<svg class="svgChart" width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">`;
  svg += `<rect x="0" y="0" width="${w}" height="${h}" rx="12" fill="rgba(0,0,0,0.15)"/>`;
  
  for (let i = 0; i < results.length; i++) {
    const r = results[i];
    const y = 20 + i * rowH;
    
    const totalW = (r.total / maxVal) * barW;
    const cutW = (r.cut / maxVal) * barW;
    
    svg += `<text x="10" y="${y + 14}" font-size="12" fill="rgba(234,240,255,0.9)">${r.name}</text>`;
    svg += `<rect x="${leftW}" y="${y + 2}" width="${cutW}" height="10" rx="3" fill="rgba(245,158,11,0.5)"/>`;
    svg += `<rect x="${leftW}" y="${y + 14}" width="${totalW}" height="10" rx="3" fill="rgba(16,185,129,0.8)"/>`;
    svg += `<text x="${leftW + Math.max(totalW, cutW) + 6}" y="${y + 14}" font-size="10" fill="rgba(234,240,255,0.7)">${r.total} / ${r.cut}</text>`;
  }
  
  svg += `</svg>`;
  container.innerHTML = svg;
}

// ============================================
// DB í¸ì§‘ ëª¨ë‹¬
// ============================================
function openModal() {
  renderEditTable();
  $("editModal").classList.add("show");
}

function closeModal() {
  $("editModal").classList.remove("show");
}

function renderEditTable() {
  const tbody = document.querySelector("#tblEdit tbody");
  tbody.innerHTML = "";
  
  for (let i = 0; i < DB.length; i++) {
    const uni = DB[i];
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="text" value="${uni.u}" data-idx="${i}" data-field="u" style="width:100px"/></td>
      <td><input type="number" value="${uni.essayW}" data-idx="${i}" data-field="essayW" style="width:60px"/></td>
      <td><input type="number" value="${uni.gpaW}" data-idx="${i}" data-field="gpaW" style="width:60px"/></td>
      <td><input type="number" value="${uni.cut || 0}" data-idx="${i}" data-field="cut" style="width:60px"/></td>
      <td><input type="text" value="${uni.gpaTable || ''}" data-idx="${i}" data-field="gpaTable" style="width:80px"/></td>
      <td><input type="text" value="${(uni.tags || []).join(',')}" data-idx="${i}" data-field="tags" style="width:100px"/></td>
      <td><input type="text" value="${uni.memo || ''}" data-idx="${i}" data-field="memo" style="width:150px"/></td>
    `;
    tbody.appendChild(tr);
  }
  
  tbody.querySelectorAll("input").forEach(inp => {
    inp.addEventListener("change", e => {
      const idx = parseInt(e.target.dataset.idx);
      const field = e.target.dataset.field;
      let val = e.target.value;
      
      if (field === "essayW" || field === "gpaW" || field === "cut") {
        val = parseFloat(val) || 0;
      } else if (field === "tags") {
        val = val.split(",").map(s => s.trim()).filter(s => s);
      }
      
      DB[idx][field] = val;
    });
  });
}

function addUni() {
  DB.push({ u: "ìƒˆ ëŒ€í•™", essayW: 100, gpaW: 0, cut: 70, gpaTable: "ë“±ê¸‰ë³„", tags: [], memo: "" });
  renderEditTable();
}

function saveAndClose() {
  saveDB();
  buildUniOptions();
  calculate();
  closeModal();
}

// ============================================
// ì´ë²¤íŠ¸ ë°”ì¸ë”©
// ============================================
document.addEventListener("DOMContentLoaded", () => {
  loadDB();
  buildUniOptions();
  renderDataTable();
  calculate();
  
  $("inFilter").addEventListener("change", () => { buildUniOptions(); calculate(); });
  $("inUni").addEventListener("change", calculate);
  $("inGpa").addEventListener("input", calculate);
  $("inEssay").addEventListener("input", calculate);
  
  $("btnCalc").addEventListener("click", calculate);
  $("btnRanking").addEventListener("click", () => {
    $("topCard").scrollIntoView({ behavior: "smooth" });
  });
  $("btnEdit").addEventListener("click", openModal);
  
  $("btnClose").addEventListener("click", closeModal);
  $("btnSave").addEventListener("click", saveAndClose);
  $("btnAddUni").addEventListener("click", addUni);
  $("btnReset").addEventListener("click", resetDB);
  
  document.addEventListener("keydown", e => { if (e.key === "Escape") closeModal(); });
});
</script>

</body>
</html>
